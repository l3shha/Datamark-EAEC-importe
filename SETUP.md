# Инструкция по настройке и использованию

## Настройка окружения

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Настройка переменных окружения

Скопируйте файл `.env.example` в `.env`:

```bash
copy .env.example .env
```

Отредактируйте `.env` и укажите ваши учетные данные:

```env
API_BASE_URL=https://sandbox-api.datamark.by
API_USERNAME=ваш_логин
API_PASSWORD=ваш_пароль
```

**Важно:**
- Для тестирования используйте `https://sandbox-api.datamark.by`
- Для продакшена используйте `https://api.datamark.by`

### 3. Запуск приложения

```bash
python app.py
```

Приложение будет доступно по адресу: `http://localhost:5000`

## Использование

### Формат файлов

#### Файл 1: Описания товаров
Формат: `GTIN; описание товара; количество`

Пример:
```
04660575291478; БОСОНОЖКИ Женские Pons Quintana арт. 10799000 SONIA цвет. ЧЕРНЫЙ р.37; 1
04660575291485; БОСОНОЖКИ Женские Pons Quintana арт. 10799000 SONIA цвет. ЧЕРНЫЙ р.37.5; 1
```

#### Файл 2: Коды маркировки
Формат: одна строка = один неполный код маркировки

Пример:
```
0104660575291478215GQNjOY>S3!sQ
0104660575291485215&xE6jq>TVW<a
```

### Процесс работы

1. **Загрузка файлов**: Выберите оба файла через веб-интерфейс
2. **Парсинг**: Приложение автоматически распарсит файлы и определит, сколько кодов нужно заказать
3. **Авторизация**: Автоматическая авторизация в API ГИС «Электронный знак»
4. **Заказ кодов**: Автоматический заказ недостающих частей кодов (криптохвостов)
5. **Ожидание**: Приложение будет проверять статус заказа каждые 5 секунд
6. **Скачивание**: После выполнения заказа автоматически скачиваются полные коды
7. **Отчет**: Отправка отчета о вводе товаров в оборот
8. **Проверка**: Отслеживание статуса обработки отчетов

### Логирование

Все операции логируются в файл `app.log` и выводятся в консоль.

Уровень логирования можно настроить в `.env`:
```env
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR
```

## Устранение неполадок

### Ошибка авторизации
- Проверьте правильность учетных данных в `.env`
- Убедитесь, что используете правильный URL (sandbox или production)

### Ошибка парсинга файлов
- Проверьте формат файлов (разделитель - точка с запятой)
- Убедитесь, что файлы в кодировке UTF-8

### Таймауты
- По умолчанию максимальное время ожидания - 300 секунд (5 минут)
- Можно изменить в `.env`: `MAX_WAIT_TIME=600`

## Структура проекта

```
тест/
├── app.py              # Основное Flask приложение
├── api_client.py       # Клиент для работы с API
├── file_parser.py      # Парсер файлов
├── config.py           # Конфигурация
├── requirements.txt    # Зависимости Python
├── .env                # Переменные окружения (не в git)
├── .env.example        # Пример конфигурации
├── templates/          # HTML шаблоны
│   └── index.html
├── static/             # Статические файлы
│   ├── style.css
│   └── script.js
└── README.md           # Документация
```
